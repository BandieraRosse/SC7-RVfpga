#include "print.h"
#include "figlet.h"
#include "string.h"


char figlet_big[7][4096]; //< 缓冲区
int figlet_lens=0;


// 定义一个数组来存储所有字符的ASCII艺术表示
FigletChar figlet_chars[256] = {
  // 控制字符 (0-31) 留空
  {0, {"", "", "", "", "", "", ""}},
  // ... 其他控制字符类似处理
  
  // 空格 (32)
  {
      ' ',
      {
          "     ",
          "     ",
          "     ",
          "     ",
          "     ",
          "     ",
          "     "
      }
  },
  
  // 感叹号 (33)
  {
      '!',
      {
          "  _ ",
          " | |",
          " | |",
          " | |",
          " |_|",
          " (_)",
          "    "
      }
  },
  
  // 双引号 (34)
  {
      '"',
      {
          "  _ _ ",
          " ( | )",
          "  V V ",
          "   $  ",
          "   $  ",
          "   $  ",
          "      "
      }
  },
  
  // 井号 (35)
  {
      '#',
      {
          "    _  _   ",
          "  _| || |_ ",
          " |_  __  _|",
          "  _| || |_ ",
          " |_  __  _|",
          "   |_||_|  ",
          "           "
      }
  },
  
  // 美元符号 (36)
  {
      '$',
      {
          "   _  ",
          "  | | ",
          " / __)",
          " \\__ \\",
          " (   /",
          "  |_| ",
          "      "
      }
  },
  
  // 百分号 (37)
  {
      '%',
      {
          "  _   __",
          " (_) / /",
          "    / / ",
          "   / /  ",
          "  / / _ ",
          " /_/ (_)",
          "        "
      }
  },
  
  // 与符号 (38)
  {
      '&',
      {
          "         ",
          "   ___   ",
          "  ( _ )  ",
          "  / _ \\/\\",
          " | (_>  <",
          "  \\___/\\/",
          "         "
      }
  },
  
  // 单引号 (39)
  {
      '\'',
      {
          "  _ ",
          " ( )",
          " |/ ",
          "  $ ",
          "  $ ",
          "  $ ",
          "    "
      }
  },
  
  // 左括号 (40)
  {
      '(',
      {
          "   __",
          "  / /",
          " | | ",
          " | | ",
          " | | ",
          " | | ",
          "  \\_\\"
      }
  },
  
  // 右括号 (41)
  {
      ')',
      {
          " __  ",
          " \\ \\ ",
          "  | |",
          "  | |",
          "  | |",
          "  | |",
          " /_/ "
      }
  },
  
  // 星号 (42)
  {
      '*',
      {
          "     _    ",
          "  /\\| |/\\ ",
          "  \\ ` ' / ",
          " |_     _|",
          "  / , . \\ ",
          "  \\/|_|\\/ ",
          "          "
      }
  },
  
  // 加号 (43)
  {
      '+',
      {
          "        ",
          "    _   ",
          "  _| |_ ",
          " |_   _|",
          "   |_|  ",
          "    $   ",
          "        "
      }
  },
  
  // 逗号 (44)
  {
      ',',
      {
          "    ",
          "    ",
          "    ",
          "    ",
          "  _ ",
          " ( )",
          " |/ "
      }
  },
  
  // 减号 (45)
  {
      '-',
      {
          "         ",
          "         ",
          "  ______ ",
          " |______|",
          "     $   ",
          "     $   ",
          "         "
      }
  },
  
  // 句号 (46)
  {
      '.',
      {
          "    ",
          "    ",
          "    ",
          "    ",
          "  _ ",
          " (_)",
          "    "
      }
  },
  
  // 斜杠 (47)
  {
      '/',
      {
          "      __",
          "     / /",
          "    / / ",
          "   / /  ",
          "  / /   ",
          " /_/    ",
          "        "
      }
  },
  
  // 数字0-9
  {
      '0',
      {
          "   ___  ",
          "  / _ \\ ",
          " | | | |",
          " | | | |",
          " | |_| |",
          "  \\___/ ",
          "        "
      }
  },
  {
      '1',
      {
          "  _ ",
          " / |",
          " | |",
          " | |",
          " | |",
          " |_|",
          "    "
      }
  },
  {
      '2',
      {
          "  ___ ",
          " |_  )",
          "  / / ",
          " /___|",
          "   $  ",
          "   $  ",
          "      "
      }
  },
  {
      '3',
      {
          "  ____",
          " |__ /",
          "  |_ \\",
          " |___/",
          "   $  ",
          "   $  ",
          "      "
      }
  },
  {
      '4',
      {
          "  __ ",
          " /_ |",
          "  | |",
          "  | |",
          "  |_|",
          "     ",
          "     "
      }
  },
  {
      '5',
      {
          "  ___ ",
          " |__ \\ ",
          "    ) |",
          "   / / ",
          "  / /_ ",
          " |____|",
          "       "
      }
  },
  {
      '6',
      {
          "   ____ ",
          "  / __ \\ ",
          " | |__) |",
          " |  __ < ",
          " | |__) |",
          "  \\____/ ",
          "         "
      }
  },
  {
      '7',
      {
          "  ______ ",
          " |____  |",
          "    $/ / ",
          "    / /  ",
          "   / /   ",
          "  /_/    ",
          "         "
      }
  },
  {
      '8',
      {
          "   ___  ",
          "  / _ \\ ",
          " | (_) |",
          "  > _ < ",
          " | (_) |",
          "  \\___/ ",
          "        "
      }
  },
  {
      '9',
      {
          "   ___  ",
          "  / _ \\ ",
          " | (_) |",
          "  \\__, |",
          "    / / ",
          "   /_/  ",
          "        "
      }
  },
  
  // 冒号 (58)
  {
      ':',
      {
          "    ",
          "  _ ",
          " (_)",
          "  $ ",
          "  _ ",
          " (_)",
          "    "
      }
  },
  
  // 分号 (59)
  {
      ';',
      {
          "    ",
          "  _ ",
          " (_)",
          "  $ ",
          "  _ ",
          " ( )",
          " |/ "
      }
  },
  
  // 小于号 (60)
  {
      '<',
      {
          "    __",
          "   / /",
          "  / / ",
          " < <  ",
          "  \\ \\ ",
          "   \\_\\",
          "      "
      }
  },
  
  // 等于号 (61)
  {
      '=',
      {
          "         ",
          "         ",
          "  ______ ",
          " |______|",
          "  ______ ",
          " |______|",
          "         "
      }
  },
  
  // 大于号 (62)
  {
      '>',
      {
          " __   ",
          " \\ \\  ",
          "  \\ \\ ",
          "   > >",
          "  / / ",
          " /_/  ",
          "      "
      }
  },
  
  // 问号 (63)
  {
      '?',
      {
          "    _  ",
          "   (_) ",
          "   | | ",
          "  / /  ",
          " | (__ ",
          "  \\___|",
          "       "
      }
  },
  
  // @符号 (64)
  {
      '@',
      {
          "          ",
          "    ____  ",
          "   / __ \\ ",
          "  / / _` |",
          " | | (_| |",
          "  \\ \\__,_|",
          "   \\____/ "
      }
  },
  
  // 大写字母A-Z
  {
      'A',
      {
          "   _   _  ",
          "  (_)_(_) ",
          "    / \\   ",
          "   / _ \\  ",
          "  / ___ \\ ",
          " /_/   \\_\\",
          "          "
      }
  },
  {
      'B',
      {
          "  ____  ",
          " |  _ \\ ",
          " | |_) )",
          " |  _ ( ",
          " | |_) )",
          " |____/ ",
          "        "
      }
  },
  {
      'C',
      {
          "   _____ ",
          "  / ____|",
          " | | $   ",
          " | | $   ",
          " | |____ ",
          "  \\_____|",
          "         "
      }
  },
  {
      'D',
      {
          "  _____  ",
          " |  __ \\ ",
          " | |  | |",
          " | |  | |",
          " | |__| |",
          " |_____/ ",
          "         "
      }
  },
  {
      'E',
      {
          "  _____ ",
          " |  ___)",
          " | |_   ",
          " |  _)  ",
          " | |___ ",
          " |_____)",
          "        "
      }
  },
  {
      'F',
      {
          "  _____ ",
          " |  ___)",
          " | |_   ",
          " |  _)  ",
          " | |    ",
          " |_|    ",
          "        "
      }
  },
  {
      'G',
      {
          "   ____  ",
          "  / __ \\ ",
          " | |  | |",
          " | |  | |",
          " | |__| |",
          "  \\____/ ",
          "         "
      }
  },
  {
      'H',
      {
          "  _    _ ",
          " | |  | |",
          " | |__| |",
          " |  __  |",
          " | |  | |",
          " |_|  |_|",
          "         "
      }
  },
  {
      'I',
      {
          "  ___ ",
          " (   )",
          "  | | ",
          "  | | ",
          "  | | ",
          " (___)",
          "      "
      }
  },
  {
    'J',
    {
        "      _ ",
        "     | |",
        "     | |",
        "     | |",
        " _   | |",
        "| |__| |",
        " \\____/ "
        }
  },
  {
      'K',
      {
          "  _   __",
          " | | / /",
          " | |/ / ",
          " |   <  ",
          " | |\\ \\ ",
          " |_| \\_\\",
          "        "
      }
  },
  {
      'L',
      {
          "  _      ",
          " | |     ",
          " | |     ",
          " | |     ",
          " | |____ ",
          " |______|",
          "         "
      }
  },
  {
      'M',
       {
        "  __  __  ",
        " |  \\/  | ",
        " | |\\/| | ",
        " |_|  |_| ",
        "          ",
        "          ",
        "          "
    }
  },
  {
      'N',
       {
        "  _    _ ",
        " | \\  | |",
        " |  \\ | |",
        " |_| \\|_|",
        "         ",
        "         ",
        "         "
        }
  },
  {
    'O',
    {
        "   ___  ",
        "  / _ \\ ",
        " | | | |",  // 更对称的中间部分
        " | | | |",  // 调整下划线位置
        " | |_| |",
        "  \\___/ ",  // 底部闭合
        "        "
    }
},
  {
      'P',
      {
          "  ____  ",
          " |  _ \\ ",
          " | |_) |",
          " |  __/ ",
          " | |    ",
          " |_|    ",
          "        "
      }
  },
  {
      'Q',
      {
          "   ____  ",
          "  / __ \\ ",
          " | |  | |",
          " | |  | |",
          " | |__| |",
          "  \\___\\_\\",
          "         "
      }
  },
  {
      'R',
      {
          "  _____  ",
          " |  __ \\ ",
          " | |__) |",
          " |  _  / ",
          " | | \\ \\ ",
          " |_|  \\_\\",
          "         "
      }
  },
  {
      'S',
      {
          "   _____ ",
          "  / ____|",
          " | (___  ",
          "  \\___ \\ ",
          "  ____) |",
          " |_____/ ",
          "         "
      }
  },
  {
      'T',
      {
          "  _______ ",
          " |__   __|",
          "    | |   ",
          "    | |   ",
          "    | |   ",
          "    |_|   ",
          "          "
      }
  },
  {
      'U',
      {
          "  _    _ ",
          " | |  | |",
          " | |  | |",
          " | |  | |",
          " | |__| |",
          "  \\____/ ",
          "         "
      }
  },
  {
      'V',
      {
          " __      __",
          " \\ \\    / /",
          "  \\ \\  / / ",
          "   \\ \\/ /  ",
          "    \\  /   ",
          "     \\/    ",
          "           "
      }
  },
  {
      'W',
      {
          " __          __",
          " \\ \\        / /",
          "  \\ \\  /\\  / / ",
          "   \\ \\/  \\/ /  ",
          "    \\  /\\  /   ",
          "     \\/  \\/    ",
          "               "
      }
  },
  {
      'X',
      {
          " __   __",
          " \\ \\ / /",
          "  \\ V / ",
          "   > <  ",
          "  / . \\ ",
          " /_/ \\_\\",
          "        "
      }
  },
  {
      'Y',
      {
          " __     __",
          " \\ \\   / /",
          "  \\ \\_/ / ",
          "   \\   /  ",
          "    | |   ",
          "    |_|   ",
          "          "
      }
  },
  {
      'Z',
      {
          "  ______",
          " |___  /",
          "    / / ",
          "   / /  ",
          "  / /__ ",
          " /_____|",
          "        "
      }
  },
  
  // 左方括号 (91)
  {
      '[',
      {
          "  ___ ",
          " |  _|",
          " | |  ",
          " | |  ",
          " | |  ",
          " | |_ ",
          " |___|"
      }
  },
  
  // 反斜杠 (92)
  {
      '\\',
      {
          " __     ",
          " \\ \\    ",
          "  \\ \\   ",
          "   \\ \\  ",
          "    \\ \\ ",
          "     \\_\\",
          "        "
      }
  },
  
  // 右方括号 (93)
  {
      ']',
      {
          "  ___ ",
          " |_  |",
          "   | |",
          "   | |",
          "   | |",
          "  _| |",
          " |___|"
      }
  },
  
  // 脱字符 (94)
  {
      '^',
      {
          "  /\\ ",
          " |/\\|",
          "   $ ",
          "   $ ",
          "   $ ",
          "   $ ",
          "     "
      }
  },
  
  // 下划线 (95)
  {
      '_',
      {
          "         ",
          "         ",
          "         ",
          "         ",
          "     $   ",
          "  ______ ",
          " |______|"
      }
  },
  
  // 反引号 (96)
  {
      '`',
      {
          "  _ ",
          " ( )",
          "  \\|",
          "   $",
          "   $",
          "   $",
          "    "
      }
  },
  
  // 小写字母a-z
  {
      'a',
      {
          "        ",
          "        ",
          "   __ _ ",
          "  / _` |",
          " | (_| |",
          "  \\__,_|",
          "        "
      }
  },
  {
      'b',
      {
          "        ",
          "  _     ",
          " | |__  ",
          " | '_ \\ ",
          " | |_) |",
          " |_.__/ ",
          "        "
      }
  },
  {
      'c',
      {
          "       ",
          "       ",
          "   ___ ",
          "  / __|",
          " | (__ ",
          "  \\___|",
          "       "
      }
  },
  {
      'd',
      {
          "       _ ",
          "      | |",
          "   ___| |",
          "  /  _' |",
          " |  (_| |",
          "  \\___._|",
          "         "
      }
  },
  {
      'e',
      {
          "       ",
          "       ",
          "   ___ ",
          "  / _ \\",
          " |  __/",
          "  \\___|",
          "       "
      }
  },
  {
      'f',
      {
          "   __ ",
          "  / _|",
          " | |_ ",
          " |  _|",
          " | |  ",
          " |_|  ",
          "      "
      }
  },
  {
      'g', //< 多了一行
      {
        //  "        ",
          "        ",
          "   __ _ ",
          "  / _` |",
          " | (_| |",
          "  \\__, |",
          "   __/ |",
          "  |___/ "
      }
  },
  {
      'h',
      {
          "  _     ",
          " | |    ",
          " | |__  ",
          " | '_ \\ ",
          " | | | |",
          " |_| |_|",
          "        "
      }
  },
  {
      'i',
      {
          "  _ ",
          " (_)",
          "  _ ",
          " | |",
          " | |",
          " |_|",
          "    "
      }
  },
  {
      'j',
      {
//          "     _",
          "    (_)",
          "     _ ",
          "    | |",
          "    | |",
          "    | |",
          "  _/ / ",
          " |__/  "
      }
  },
  {
      'k',
      {
          "  _    ",
          " | | _ ",
          " | |/ /",
          " |   < ",
          " |_|\\_\\",
          "       ",
          "       "
      }
  },
  {
      'l',
      {
          "  _ ",
          " | |",
          " | |",
          " | |",
          " | |",
          " |_|",
          "    "
      }
  },
  {
      'm',
      {
          "            ",
          "            ",
          "  _ __ ___  ",
          " | '_ ` _ \\ ",
          " | | | | | |",
          " |_| |_| |_|",
          "            "
      }
  },
  {
      'n',
      {
          "        ",
          "        ",
          "  _ __  ",
          " | '_ \\ ",
          " | | | |",
          " |_| |_|",
          "        "
      }
  },
  {
      'o',
      {
          "        ",
          "        ",
          "   ___  ",
          "  / _ \\ ",
          " | (_) |",
          "  \\___/ ",
          "        "
      }
  },
  {
      'p',
      {
        //  "        ",
          "        ",
          "  _ __  ",
          " | '_ \\ ",
          " | |_) |",
          " | .__/ ",
          " | |    ",
          " |_|    "
      }
  },
  {
      'q',
      {
        //  "         ",
          "         ",
          "   __ _  ",
          "  / _` | ",
          " | (_| | ",
          "  \\__, | ",
          "     | | ",
          "     |_| "
      }
  },
  {
      'r',
      {
          "       ",
          "       ",
          "  _ __ ",
          " | '__|",
          " | |   ",
          " |_|   ",
          "       "
      }
  },
  {
      's',
      {
          "       ",
          "       ",
          "   ___ ",
          "  / __|",
          "  \\__ \\",
          "  |___/",
          "       "
      }
  },
  {
      't',
      {
          "  _   ",
          " | |  ",
          " | |_ ",
          " | __|",
          " | |_ ",
          "  \\__|",
          "      "
      }
  },
  {
      'u',
      {
          "        ",
          "        ",
          "  _   _ ",
          " | | | |",
          " | |_| |",
          "  \\__,_|",
          "        "
      }
  },
  {
      'v',
      {
          "        ",
          "        ",
          " __   __",
          " \\ \\ / /",
          "  \\ V / ",
          "   \\_/  ",
          "        "
      }
  },
  {
      'w',
      {
          "           ",
          "           ",
          " __      __",
          " \\ \\ /\\ / /",
          "  \\ V  V / ",
          "   \\_/\\_/  ",
          "           "
      }
  },
  {
      'x',
      {
          "       ",
          "       ",
          " __  __",
          " \\ \\/ /",
          "  >  < ",
          " /_/\\_\\",
          "       "
      }
  },
  {
      'y',
      {
        //  "        ",
          "        ",
          "  _   _ ",
          " | | | |",
          " | |_| |",
          "  \\__, |",
          "   __/ |",
          "  |___/ "
      }
  },
  {
      'z',
      {
          "       ",
          "       ",
          " _____ ",
          "|__  / ",
          "  / /  ",
          " /___| ",
          "       "
      }
  },
  
  // 左大括号 (123)
  {
      '{',
      {
          "    __",
          "   / /",
          "  | | ",
          " / /  ",
          "  \\ \\ ",
          "   \\_\\",
          "      "
      }
  },
  
  // 竖线 (124)
  {
      '|',
      {
          "  _",
          " | |",
          " | |",
          " | |",
          " | |",
          " | |",
          " |_|"
      }
  },
  
  // 右大括号 (125)
  {
      '}',
      {
          " __   ",
          " \\ \\  ",
          "  | | ",
          "  \\ \\ ",
          " / /  ",
          "/_/   ",
          "      "
      }
  },
  
  // 波浪号 (126)
  {
      '~',
      {
          "  /\\/|",
          " |/\\/ ",
          "   $  ",
          "   $  ",
          "   $  ",
          "   $  ",
          "      "
      }
  },
  
  // 删除符 (127)
  {
      127,
      {
          "   _   _  ",
          "  (_)_(_) ",
          "    / \\   ",
          "   / _ \\  ",
          "  / ___ \\ ",
          " /_/   \\_\\",
          "          "
      }
  }
};

























int add_figlet_char(char c)
{
  int i;
  for(i=0;i<256;i++)//查找
  {
    if(c==figlet_chars[i].code)
      break;
  }
  if(i==256) //没有查找到字体
  {
    printf("no font for char: %d\n",c); //<没有%c
    return 1;//<错误
  }
  for(int j=0;j<7;j++)
  {
    char *str_tocpy = figlet_chars[i].lines[j];
    //printf("%s\n",str_tocpy);
    memmove(figlet_big[j]+figlet_lens,str_tocpy,strlen(str_tocpy));
  }
  figlet_lens += strlen(figlet_chars[i].lines[0]);//第一行的长度，要求字体每行长度相同。下一个字体才会在缓存的正确位置
  return 0;
}

void print_figlet_buffer()
{
  for(int i=0;i<7;i++) //< 7行
  {
    for(int j=0;j<figlet_lens;j++) //< 输出一行的全部内容
    {
      consputc(figlet_big[i][j]);
    }
    consputc('\n'); //< 输出完一行后换行
  }
}

void printf_figlet(char *fmt)
{
  /*开头不清零，如果printf_figlet之前，缓冲区就有数据比如HH，输出会是HH+fmt*/
  figlet_lens=0; 

  while(*fmt) //< 把结尾的\0之前的内容的字体存入figlet_buff
  {
    if(!add_figlet_char(*fmt++))
    {
      //< add_figlet_char返回0,正确。继续执行就可以
    }
    else //< add_figlet_char返回-1,出错了
    {
      printf("未识别的字符,printf_figlet failed\n");
      return;
    }
  }
  print_figlet_buffer();

  /*结束时把figlet_lens置零，标识figlet_big可用*/
  figlet_lens=0; //< 不需要清理figlet_big，下次打印也应该正常
}

void test_figlet()
{
    // add_figlet_char('H');
    // add_figlet_char('H');
    // print_figlet_buffer();
    printf("开始测试\n");
    printf_figlet("SH");
    add_figlet_char('H');
    add_figlet_char('H');
    printf_figlet("SS");
    //printf_figlet("AC");
    printf_figlet("SC7");
    while(1)
    ;
}